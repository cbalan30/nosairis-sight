{% extends 'adminlte/base.html' %}

{% load static %}

{# --- 1. SET THE PAGE TITLE --- #}
{% block title %}Switch Status{% endblock title %}

{# --- 2. SET THE BROWSER TAB TITLE --- #}
{% block page_title %}Switch Status{% endblock page_title %}

{# --- 3. CREATE BREADCRUMBS (Optional) --- #}
{% block page_breadcrumb %}
    <li class="breadcrumb-item"><a href="/">Home</a></li>
    <li class="breadcrumb-item active">Status</li>
{% endblock page_breadcrumb %}

{% block extrahead %}
   
{% endblock %}

{% block extra_css %}

{% endblock extra_css %}


{# --- 4. INSERT MAIN PAGE CONTENT HERE --- #}
{% block content %}
<div class="content-header">
    <div class="container-fluid">
        <h1>{{ page_title }}</h1>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="card card-primary card-outline">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="far fa-chart-bar"></i>
                            Switch Ping Availability
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">   
                            <div class="col-lg-12">
                                <canvas id="switchStatusChart1" style="height: 400px;"></canvas>
                            </div>
                        </div>

                        <div class="row">   
                            <div class="col-lg-12">
                                <canvas id="switchStatusChart2" style="height: 400px;"></canvas>
                            </div>
                        </div>

                        <div class="row">   
                            <div class="col-lg-12">
                                <canvas id="switchStatusChart3" style="height: 400px;"></canvas>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock content %}

{# --- 5. CUSTOM FOOTER TEXT (Optional) --- #}
{% block footer_text %}
    Custom Footer Text for My App.
{% endblock footer_text %}

{# --- 6. ADD CUSTOM JS (Optional) --- #}

{% block extra_js %}


<script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js"></script>

<script>
    // Global variable to hold the chart instance
    let switchStatusChart1 = null; 
    let switchStatusChart2 = null; 
    let switchStatusChart3 = null; 
    const chartUrl = "{% url 'switch_status_data' %}";

    


    // --- 2. Chart Loading Function (Modified) ---
    function loadSwitchStatusChart1() {
        
        // Construct the URL with query parameters for start and end dates
        const dataUrl = `${chartUrl}?switch_id=1`;

        $.getJSON(dataUrl, function(data) {
            
            // Destroy existing chart instance before creating a new one
            if (switchStatusChart1) {
                switchStatusChart1.destroy();
            }
            
            // ... (The rest of your chart dataset preparation logic remains the same) ...
            const chartDatasets = data.datasets.map(function(dataset, index) {
                const colors = ['#007bff', '#28a745', '#ffc107', '#dc3545', '#17a2b8'];
                const color = colors[index % colors.length];
                
                return {
                    label: dataset.label,
                    data: dataset.data,
                    backgroundColor: 'rgba(0, 0, 0, 0)', 
                    borderColor: color,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    borderWidth: 2,
                    fill: false,
                    stepped: true,
                    // Note: Chart.js 4+ uses 'segment' for advanced styling, 
                    // this part can be simplified/removed if not using advanced color-per-segment logic.
                };
            });

            // --- 3. Initialize the Chart ---
            const ctx = document.getElementById('switchStatusChart1').getContext('2d'); 
 
            
            switchStatusChart1 = new Chart(ctx, { // Assign to the global variable
                type: 'line', 
                data: {
                    labels: data.labels, 
                    datasets: chartDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    // ... (Other options like scales and ticks are the same) ...
                    scales: {
                        x: {
                            type: 'category', 
                            title: { display: true, text: 'Time (log_at)' },
                            ticks: { maxTicksLimit: 15 }
                        },
                        y: {
                            min: 0,
                            max: 1,
                            beginAtZero: true,
                            title: { display: true, text: 'Ping Availability (0=DOWN, 1=UP)' },
                            ticks: { stepSize: 1, callback: function(value) { return value === 1 ? 'UP' : 'DOWN'; } }
                        }
                    },
                }
            });
        }).fail(function() {
            console.error("Failed to load chart data.");
            // Handle error (e.g., show a message to the user)
        });
    }

    function loadSwitchStatusChart2() {
        
        // Construct the URL with query parameters for start and end dates
        const dataUrl = `${chartUrl}?switch_id=2`;

        $.getJSON(dataUrl, function(data) {
            
            // Destroy existing chart instance before creating a new one
            if (switchStatusChart2) {
                switchStatusChart2.destroy();
            }
            
            // ... (The rest of your chart dataset preparation logic remains the same) ...
            const chartDatasets = data.datasets.map(function(dataset, index) {
                const colors = ['#28a745', '#ffc107', '#dc3545', '#17a2b8', '#007bff'];
                const color = colors[index % colors.length];
                
                return {
                    label: dataset.label,
                    data: dataset.data,
                    backgroundColor: 'rgba(0, 0, 0, 0)', 
                    borderColor: color,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    borderWidth: 2,
                    fill: false,
                    stepped: true,
                    // Note: Chart.js 4+ uses 'segment' for advanced styling, 
                    // this part can be simplified/removed if not using advanced color-per-segment logic.
                };
            });

            // --- 3. Initialize the Chart ---
            const ctx = document.getElementById('switchStatusChart2').getContext('2d'); 
 
            
            switchStatusChart2 = new Chart(ctx, { // Assign to the global variable
                type: 'line', 
                data: {
                    labels: data.labels, 
                    datasets: chartDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    // ... (Other options like scales and ticks are the same) ...
                    scales: {
                        x: {
                            type: 'category', 
                            title: { display: true, text: 'Time (log_at)' },
                            ticks: { maxTicksLimit: 15 }
                        },
                        y: {
                            min: 0,
                            max: 1,
                            beginAtZero: true,
                            title: { display: true, text: 'Ping Availability (0=DOWN, 1=UP)' },
                            ticks: { stepSize: 1, callback: function(value) { return value === 1 ? 'UP' : 'DOWN'; } }
                        }
                    },
                }
            });
        }).fail(function() {
            console.error("Failed to load chart data.");
            // Handle error (e.g., show a message to the user)
        });
    }

    function loadSwitchStatusChart3() {
        
        // Construct the URL with query parameters for start and end dates
        const dataUrl = `${chartUrl}?switch_id=3`;

        $.getJSON(dataUrl, function(data) {
            
            // Destroy existing chart instance before creating a new one
            if (switchStatusChart3) {
                switchStatusChart3.destroy();
            }
            
            // ... (The rest of your chart dataset preparation logic remains the same) ...
            const chartDatasets = data.datasets.map(function(dataset, index) {
                const colors = ['#ffc107', '#dc3545', '#17a2b8', '#007bff', '#28a745'];
                const color = colors[index % colors.length];
                
                return {
                    label: dataset.label,
                    data: dataset.data,
                    backgroundColor: 'rgba(0, 0, 0, 0)', 
                    borderColor: color,
                    pointRadius: 3,
                    pointHoverRadius: 5,
                    borderWidth: 2,
                    fill: false,
                    stepped: true,
                    // Note: Chart.js 4+ uses 'segment' for advanced styling, 
                    // this part can be simplified/removed if not using advanced color-per-segment logic.
                };
            });

            // --- 3. Initialize the Chart ---
            const ctx = document.getElementById('switchStatusChart3').getContext('2d'); 
 
            
            switchStatusChart3 = new Chart(ctx, { // Assign to the global variable
                type: 'line', 
                data: {
                    labels: data.labels, 
                    datasets: chartDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    // ... (Other options like scales and ticks are the same) ...
                    scales: {
                        x: {
                            type: 'category', 
                            title: { display: true, text: 'Time (log_at)' },
                            ticks: { maxTicksLimit: 15 }
                        },
                        y: {
                            min: 0,
                            max: 1,
                            beginAtZero: true,
                            title: { display: true, text: 'Ping Availability (0=DOWN, 1=UP)' },
                            ticks: { stepSize: 1, callback: function(value) { return value === 1 ? 'UP' : 'DOWN'; } }
                        }
                    },
                }
            });
        }).fail(function() {
            console.error("Failed to load chart data.");
            // Handle error (e.g., show a message to the user)
        });
    }

    // Load chart initially with default 24h range
    $(function () {        
        loadSwitchStatusChart1();
        loadSwitchStatusChart2();
        loadSwitchStatusChart3();
    });
</script>
{% endblock extra_js %}